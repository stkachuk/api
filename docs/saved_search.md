# Автопоиск

Автопоиск — это сохраненный набор параметров поиска, по которому можно отслеживать сколько всего соответствующих вакансий есть в базе и сколько из них появилось с момента последнего просмотра.

Помимо сохранения параметров поисковых запросов, автопоиск позволяет получать оповещения по почте о новых вакансиях. Для удобства автопоиску можно задавать имя.

Во всех запросах по созданию, редактированию, получению, удалению автопоисков необхоидмо указывать авторизацию (заголовок ```Authorization```), в противном случае вернется статус ```HTTP 403 Forbidden```.


## Получение списка автопоисков

```GET /saved_searches/vacancies``` вернет список автопоисков с пагинацией.

Принимаемые параметры:

 - ```page``` - номер страницы автопоисков (считается от 0, по умолчанию - 0)

 - ```per_page``` - количество элементов автопоисков (по умолчанию - 10, максимальное значение - 10)


Ответом будет стандартная коллекция автопоисков с пагинацией.


```json
{
  "per_page": 1,
  "page": 0,
  "found": 1,
  "pages": 1,
  "items": [
    {
      "id": "123",
      "name": "Test autosearch",
      "created_at": "2014-04-11T13:12:17+0400",
      "email_subscription": true,
      "items": {
        "count": 304234,
        "url": "https://api.hh.ru/vacancies?area=1&saved_search_id=123"
      },
      "new_items": {
        "count": 12,
        "url": "https://api.hh.ru/vacancies?area=1&saved_search_id=123&date_from=2014-01-11T13%3A12%3A17%2B0400"
      }
    }
  ]
}
```

Каждый автопоиск содержит следующую информацию:

 Имя | Тип | Описание
---- | --- | ---
 id  | строка | Идентификатор автопоиска
 name | строка | Имя автопоиска
 created_at | строка | Дата и время создания автопоиска
 email_subscription | логический | Статус email подписки на автопоиск
 items | объект | Данные о списке вакансий, соответствующих автопоиску
 new_items | объект | Данные о списке вакансий, появившихся с момента последнего просмотра вакансий, относящихся к данному автопоиску.

Информация о подписке содержит email, на который производится отправка писем с информацией по вакансиям от данного автопоиска. В случае, когда подписка не оформлена, в поле email будет ```null```.
В данных о списке вакансий содержится количество элементов в поиске (```count```) и ссылка на получение данных элементов. При переходе по ссылке из ```new_items``` счетчик новых вакансий будет сброшен.

## Получение единичного автопоиска.

Для получения автопоиска по идентификатору неоходимо отправить ```GET /saved_searches/vacancies/{id}```
В случае успеха вернется статус ```HTTP 200 OK``` с единичным объектом автопоиска в теле. Например:
```json
{
  "id": "123",
  "name": "Test autosearch",
  "created_at": "2014-04-11T13:12:17+0400",
  "email_subscription": true,
  "items": {
    "count": 304234,
    "url": "https://api.hh.ru/vacancies?area=1&saved_search_id=123"
  },
  "new_items": {
    "count": 12,
    "url": "https://api.hh.ru/vacancies?area=1&saved_search_id=123&date_from=2014-01-11T13%3A12%3A17%2B0400"
  }
}
```

В случае, если автопоиск не найден - вернется статус ```HTTP 404 Not Found```.

## Создание нового сохраненного поиска

Для создания автопоиска неоходимо отправить ```POST``` запрос на ```/saved_searches/vacancies``` со следующими параметрами:

 - параметры поиска вакансий. Соответствуют параметрам, передаваемым в поиск вакансий [/vacancies](vacancies.md)

В случае успешного создания вернется ответ ```HTTP 201 Created``` с заголовком ```Location``` указывающим на созданный автопоиск (например ```/saved_searches/vacancies/123```, где 123 - id созданного автопоиска).

## Обновление сохраненного поиска

У сохраненного поиска возможно изменить имя и статус подписки, для этого необходимо послать ```PUT /saved_searches/vacancies/{id}```, где id - идентификатор сохраненного поиска.

За один заход можно изменять только имя (параметр ```name```) или только статус подписки (параметр ```email_subscription=false```).

При попытке изменить оба параметра сразу придет ответ ``` HTTP 409 Conflict```. В случае, когда автопоиск не найден, вернется ответ ```HTTP 404 Not Found```.

## Удаление сохраненного поиска

Для того, чтобы удалить автопоиск, необходимо послать ```DELETE /saved_searches/vacancies/{id}```, где id - идентификатор автопоиска. 

В случае, когда автопоиск не был найден, вернется статус ```HTTP 404 Not Found```. 

При успешном удалении автопоиска вернется статус ```HTTP 204 No Content```.

