# Автопоиск

Автопоиск - это сохраненный набор параметров поиска, по которому можно отслеживать сколько всего соответствующих вакансий по есть в базе и сколько из них появилось с момента последнего просмотра.

Помимо сохранения параметров поисковых запросов, автопоиск позволяет получать оповещения по почте о новых вакансиях. Для удобства автопоиску можно задавать имя.

Во всех запросах по созданию, редактированию, получению, удалению автопоисков необхоидмо указывать авторизацию (заголовок ```Authorization```), в противном случае вернется статус ```HTTP 403 Forbidden```.


## Получение списка автопоисков

```GET /searches``` вернет список автопоисков с пагинацией.

Принимаемые параметры:

 - ```page``` - номер страницы автопоисков (считается от 0, по умолчанию - 0)

 - ```per_page``` - количество элементов автопоисков (по умолчанию - 20)


Ответом будет стандартная коллекция автопоисков с пагинацией.


```
#!json
{
  "per_page": 1,
  "page": 0,
  "found": 1,
  "pages": 1,
  "items": [
    {
      "id": "123",
      "name": "Test autosearch",
      "created_at": "2014-04-11T13:12:17+0400",
      "subscription": {
        "email": "test@example.com"
      },
      "items": {
        "count": 304234,
        "url": "https://api.hh.ru/vacancies?area=1"
      },
      "new_items": {
        "count": 12,
        "url": "https://api.hh.ru/vacancies?area=1&saved_search_id=123&date_from=2014-01-11T13%3A12%3A17%2B0400"
      }
    }
  ]
}
```

Каждый автопоиск содержит следующую информацию:

 Имя | Тип | Описание
---- | --- | ---
 id  | строка | Идентификатор автопоиска
 name | строка | Имя автопоиска
 created_at | строка | Дата и время создания автопоиска
 subscription | объект | Статус подписки на автопоиск
 items | объект | Данные о списке вакансий, соответствующих автопоиску
 new_items | объект | Данные о списке вакансий, появившихся с момента последнего просмотра вакансий, относящихся к данному автопоиску.

Информация о подписке содержит email, на который производится отправка писем с информацией по вакансиям от данного автопоиска. В случае, когда подписка не оформлена, в поле email будет ```null```.
В данных о списке вакансий содержится количество элементов в поиске (```count```) и ссылка на получение данных элементов. При переходе по ссылке из ```new_items``` Счетчик новых вакансий будет сброшен.

## Получение единичного автопоиска.

Для получения автопоиска по его идентификатору неоходимо отправить ```GET /searches/{id}```
В случае успеха вернется статус ```HTTP 200 OK``` с единичным объектом автопоиска в теле. Например:
```
#!json
{
  "id": "123",
  "name": "Test autosearch",
  "created_at": "2014-04-11T13:12:17+0400",
  "subscription": {
    "email": null
  },
  "items": {
    "count": 304234,
    "url": "https://api.hh.ru/vacancies?area=1"
  },
  "new_items": {
    "count": 12,
    "url": "https://api.hh.ru/vacancies?area=1&saved_search_id=123&date_from=2014-01-11T13%3A12%3A17%2B0400"
  }
}
```

В случае, если автопоиск не найден - вернется статус ```HTTP 404 Not Found```.

## Создание нового автопоиска

Для создания автопоиска неоходимо отправить ```POST``` запрос на ```/searches``` со следующими параметрами:

 - ```name``` - Имя автопоиска

 - ```subscription_email``` - Подписывать ли на рассылку о новых вакансиях (true/false)

 - параметры поиска вакансий. Соответствуют параметрам, передаваемым в поиск вакансий [/vacancies](vacancies.md)

В случае успешного создания вернется ответ ```HTTP 201 Created``` с заголовком ```Location``` указывающим на созданный автопоиск (например ```/searches/123```, где 123 - id созданного автопоиска).

## Обновление автопоиска

У автопоиска возможно изменить имя и статус подписки, для этого необходимо послать ```PUT /searches/{id}```, где id - идентификатор автопоиска.

За один заход можно изменять только имя (параметр ```name```) или только статус подписки (параметр ```subscription_email```).

При попытке изменить оба параметра сразу придет ответ ``` HTTP 409 Conflict```. В случае, когда автопоиск не найден, вернется ответ ```HTTP 404 Not Found```.

## Удаление автопоиска

Для того, чтобы удалить автопоиск, необходимо послать ```DELETE /searches/{id}```, где id - идентификатор автопоиска. 

В случае, когда автопоиск не был найден, вернется статус ```HTTP 404 Not Found```. 

При успешном удалении автопоиска вернется статус ```HTTP 204 No Content```.

